---
import Layout from '../../layouts/Layout.astro';
import { getPosts, type Post } from '../../utils/sanity';
import Hero from '../../components/Hero.astro';
import BlogCard from '../../components/BlogCard.astro';
import Pagination from '../../components/Pagination.astro';
import ScrollProgress from '../../components/ScrollProgress.astro';

import heroImage from '../../assets/images/Blog-Hero.png';
import heroImageSM from '../../assets/images/Blog-Hero-SM.png';
import FilterButton from '../../components/FilterButton.astro';

export const prerender = false;
const posts = await getPosts();

const currentPage: number | null = +Astro.url.searchParams?.get('page')! || 1;
const postsPerPage: number = 4;
const totalPages: number = Math.ceil(posts.length / postsPerPage);
const pathname = new URL(Astro.request.url).pathname.split('/');
const firstPath = pathname[1];
const nextUrl: string | null =
    currentPage < totalPages ? firstPath + '?page=' + (currentPage + 1) : null;
const prevUrl: string | null = currentPage > 1 ? firstPath + '?page=' + (currentPage - 1) : null;
const postsForPage: Post[] = posts.slice(
    (currentPage - 1) * postsPerPage,
    currentPage * postsPerPage,
);

---

<Layout
    title={'Archytech Blog'}
    description={'Learn about Archytech, architect news, and architect tips on the best blog in the architecture industry!'}
    robots={false}
>
    <Hero heroBackgroundImgSrcList={[heroImageSM, heroImage]} alt='Team Hero Image'>
        <div class='bottom-10 z-20 absolute flex w-full flex-col space-y-8 md:space-y-10'>
            <h1 class='hero-h1 bottom-0 tracking-wide px-6 lg:px-20'>Team</h1>
            <div class='px-6 lg:px-20'>
                <ScrollProgress
                    isHeroScrollProgress={true}
                    barColor='bg-brand-black'
                    progressColor='bg-brand-gray'
                    barHeight='h-48 lg:h-56'
                    progress='bottom-[75%]'
                />
            </div>
        </div>
        <div
            class='bg-brand-black bg-blend-luminosity md:backdrop-blur-xl bg-opacity-50 z-10 absolute top-0 left-0 w-full md:w-[43%] h-full'
        >
        </div>
    </Hero>
    <main class="flex flex-col items-center w-full py-8 lg:py-16 lg:px-16 px-6">
        <div>
            <section class='flex flex-col space-y-4 mb-8 w-full lg:flex-row lg:space-y-0 lg:space-x-8'>
                <FilterButton id="show-all" buttonText='SHOW ALL'/>
                <FilterButton id="news" buttonText='NEWS'/>
                <FilterButton id="articles" buttonText='ARTICLES'/>
                <FilterButton id="tips" buttonText='TIPS'/>
            </section>
            <section class='grid grid-cols-1 gap-y-6 justify-items-center md:grid-cols-2 lg:grid-cols-3 md:gap-x-16 lg:gap-y-10 2xl:grid-cols-4'>
                {posts.map((post: Post) => {
                    return <BlogCard post={post}/>
                })}
            </section>
        </div>
    </main>

</Layout>

