---
import Layout from '../../layouts/Layout.astro';
import { getPosts, type Post } from '../../utils/sanity';
import Hero from '../../components/Hero.astro';
import BlogCard from '../../components/BlogCard.astro';
import Pagination from '../../components/Pagination.astro';
import ScrollProgress from '../../components/ScrollProgress.astro';

import heroImage from '../../assets/images/Blog-Hero.png';
import heroImageSM from '../../assets/images/Blog-Hero-SM.png';
import FilterButton from '../../components/FilterButton.astro';

const posts = await getPosts();

const currentPage: number | null = +Astro.url.searchParams?.get('page')! || 1;
const postsPerPage: number = 4;
const totalPages: number = Math.ceil(posts.length / postsPerPage);
const pathname = new URL(Astro.request.url).pathname.split('/');
const firstPath = pathname[1];
const nextUrl: string | null =
    currentPage < totalPages ? firstPath + '?page=' + (currentPage + 1) : null;
const prevUrl: string | null = currentPage > 1 ? firstPath + '?page=' + (currentPage - 1) : null;
const postsForPage: Post[] = posts.slice(
    (currentPage - 1) * postsPerPage,
    currentPage * postsPerPage,
);
---

<Layout
    title={'Archytech Blog'}
    description={'Learn about Archytech, architect news, and architect tips on the best blog in the architecture industry!'}
    robots={false}
>
    <Hero heroBackgroundImgSrcList={[heroImageSM, heroImage]} alt='Team Hero Image'>
        <div class='hero'>
            <h1 class='hero-h1'>Blog</h1>
            <p class='hero-paragraph'>The foremost marketplace for designing and constructing.</p>
        </div>
        <div
            class='absolute left-0 top-0 z-10 h-full w-full bg-brand-black bg-opacity-50 bg-blend-luminosity'
        >
        </div>
    </Hero>
    <main class='container flex-col py-8 lg:py-16'>
        <section class='mb-8 flex w-full flex-col space-y-4 lg:flex-row lg:space-x-8 lg:space-y-0'>
            <FilterButton id='show-all' buttonText='SHOW ALL' />
            <FilterButton id='news' buttonText='NEWS' />
            <FilterButton id='articles' buttonText='ARTICLES' />
            <FilterButton id='tips' buttonText='TIPS' />
        </section>
        <section
            class='grid grid-cols-1 justify-items-center gap-y-6 md:grid-cols-2 md:gap-x-24 lg:grid-cols-3 lg:gap-y-10'
        >
            {
                posts.map((post: Post) => {
                    return <BlogCard post={post} />;
                })
            }
        </section>
    </main>
</Layout>
